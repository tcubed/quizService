<!DOCTYPE html>
<html lang="en">
<head>
  <title>JumpJock</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Latest compiled and minified CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <link rel="stylesheet" href="style.css">
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <!-- Latest compiled JavaScript -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script> 

    <script>
function setCookie(cname, cvalue, exdays) {
  const d = new Date();
  d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
  let expires = "expires="+d.toUTCString();
  document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
}
function getCookie(cname) {
  let name = cname + "=";
  let ca = document.cookie.split(';');
  for(let i = 0; i < ca.length; i++) {
    let c = ca[i];
    while (c.charAt(0) == ' ') {
      c = c.substring(1);
    }
    if (c.indexOf(name) == 0) {
      return c.substring(name.length, c.length);
    }
  }
  return "";
}
function checkCookie() {
  let user = getCookie("username");
  if (user != "") {
    //alert("Welcome again " + user);
    document.getElementById('divRegister').style.display='none';
    document.getElementById('divJump').style.display='block';

    var e=document.getElementById('userDisplayName');
    e.innerHTML=user;
  } 
  /*else {
    user = prompt("Please enter your name:", "");
    if (user != "" && user != null) {
      setCookie("username", user, 365);
    }
  }
  */
} 
function validateEmail(emailId){
    var mailformat = /^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;
    if(emailId.value.match(mailformat)){
        document.form1.email.focus();
        return true;
    } else {
        alert("Invalid email address.");
        document.form1.email.focus();
        return false;
    }
}
function validateDistrict(dist){
    var distformat=/[A-Z]{3,5}/;
    if(dist.value.match(distformat)){return true;}
    else {
        alert('invalid district.  Use 3-5 capital letters.');
        return false;
    }
}
function register(){
    var unm=document.getElementById('username').value;
    var dnm=document.getElementById('displayname').value;
    var email=document.getElementById('email').value;
    var district=document.getElementById('district').value;

    var ok=validateEmail(document.form1.email);
    if(ok){
        ok=validateDistrict(document.form1.district);
    }
    if(ok){
        var exdays=365*4;
        setCookie('username', unm, exdays)
        setCookie('displayname', dnm, exdays)
        setCookie('email', email, exdays)
        setCookie('district', district, exdays)
        window.location.reload(true)
    }
    console.log('validation:'+ok)
}
function bugreport(){
    //var username=getCookie('username')
    var url="https://docs.google.com/forms/d/e/1FAIpQLScpNS2geMIrvfzYVegEQQpoRgLJufdnEiwJVQGoiWa_PnF-rQ/viewform?usp=pp_url&entry.1286586965="+getCookie('username')+"&entry.764548366="+getCookie('email');//+"&entry.1117624083=myfeedback"
    window.open(url, "_blank");
    //alert('ack!')
}
    </script>

</head>
<body>

<!-- Splash Screen code starts here  -->
<!--
<div class="splash">
    
    <h1 class = "splash-header">Welcome to my Codepen!!</h1>
    <img class="img-fluid" alt="New York" id="splashimg"> 
</div>
-->


<!--
<div class="toast show">
    <div class="toast-header">
      Toast Header
      <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
    </div>
    <div class="toast-body">
      Some text inside the toast body
    </div>
  </div>
  -->
<!-- Splash Screen code ends here  -->


<nav class="navbar navbar-expand-sm bg-primary navbar-dark fixed-top">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">JumpJock</a>
        <a class="navbar-brand" href="#">
        
            

        <span id="userDisplayName" style="font-size:0.8em;"></span>
        <i class="material-icons" >account_circle</i>

        <i class="material-icons" onclick="bugreport()">bug_report</i>
           
    
    </a>
        
    </div>
</nav>

<nav class="navbar navbar-expand-sm bg-primary navbar-dark fixed-bottom">
    <div class="container-fluid">
        <!--
    <a class="navbar-brand" href="mailto:tedonarrival@gmail.com?subject=Images for Jumpjock"><small>Submit district pictures!</small></a>
    -->
    <span class="navbar-text">Submit team pictures to <a href="mailto:tedonarrival@gmail.com">tedonarrival@gmail.com</a></span>
</div>
</nav> 



<div class="container-fluid" style="margin-top:60px" id="divRegister">
    <h3>Registration</h3>
    <p>Registration is to help with support, and provide personalized content; like district photos.</p>
    <form name="form1">
        <div class="input-group mb-3">
            <span class="input-group-text">Real Name</span>
            <input type="text" class="form-control" required id="username">
        </div>
        <div class="input-group mb-3">
            <span class="input-group-text">Display Name</span>
            <input type="text" class="form-control" required id="displayname">
        </div>
        <div class="input-group mb-3">
            <span class="input-group-text">Email</span>
            <input type="email" class="form-control" required id="email" placeholder="quizzer@example.com">
        </div>
        <div class="input-group mb-3">
            <span class="input-group-text">District</span>
            <input type="text" class="form-control" pattern="[A-Z]{4}" id="district" required placeholder="ABC">
        </div>
        <button type="button" class="btn btn-primary" onclick="register()">Register</button>
    </form>
</div>


<div class="container-fluid" style="margin-top:60px;display:none" id="divJump">
  <h5>Jump on random question</h5>



    <div class="row">
        <div class="col">
            <h6>Start</h6>
        </div>
        <div class="col">
            <select id="selectBook1" class="form-select form-select-sm" disabled>
                <option>Acts</option>
            </select> 
        </div>
        <div class="col">
            <div class="input-group mb-3 input-group-sm">
            <input type="text" class="form-control" placeholder="1" id="ch1" value="1">
            </div>
        </div>
        <div class="col">
            <div class="input-group mb-3 input-group-sm">
            <input type="text" class="form-control" placeholder="1" id="vs1" value="1">
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col">
            <h6>End</h6>
        </div>
        <div class="col">
        <select id="selectBook2" class="form-select form-select-sm" disabled>
            <option>Acts</option>
        </select> 
        </div>
        <div class="col">
            <div class="input-group mb-3 input-group-sm">
                <input type="text" class="form-control" placeholder="4" id="ch2" value="4">
            </div>
        </div>
        <div class="col">
            <div class="input-group mb-3 input-group-sm">
                <input type="text" class="form-control" placeholder="22" id="vs2" value="22">
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-sm-6">
            <!--<h6>Start</h6>-->
            
        </div>
        <div class="col-sm-6">
            <!--<h6>End</h6>-->
            
        </div>
    </div>

    <div class="row">
        <div class="col">
            <h6>Question Type:</h6>
        </div>
        <div class="col">
            <!--<label for="qtype" class="form-label">Question Type:</label>-->
            <select class="form-select form-select-sm" id="qtype">
                <option>ALL</option>
                <option>CR</option>
                <option>Q</option>
                <option>FT</option>
                <option>MA</option>
                <option>INT</option>
                <option>SIT</option>
            </select>
        </div>
    </div>
    <div class="mb-3">
        
    </div>

    <div class="btn-group" style="margin-top:20px">
        <button type="button" class="btn btn-primary" onclick="getQuestion()" id="buttonGet">Get Question</button>
        <button type="button" class="btn btn-primary" onclick="jump()" id="buttonJump" style="display:none">Jump</button>
        <button type="button" class="btn btn-primary" onclick="doneAnswering()" id="buttonAnswered" style="display:none">Finished Answering</button>
    </div>

    <div>
        <p id="question"></p>
        <p id="msg"></p>
        <p id="answer"></p>
    </div>
</div> 


<script>
async function getText(q,cb) {
  let myObject = await fetch(q);
  let myText = await myObject.text();
  cb(myText);
}
function getQuestion(){
    var e=document.getElementById('question')
    e.textContent='QUESTION: '
    var e=document.getElementById('answer')
    e.textContent='ANSWER: '
    var e=document.getElementById('msg')
    e.textContent='';


    url='api.php?'
    // get books
    var opt=document.getElementById('selectBook1').options
    bk1=opt[opt.selectedIndex].value
    opt=document.getElementById('selectBook2').options
    bk2=opt[opt.selectedIndex].value

    var ch1=document.getElementById('ch1').value
    var ch2=document.getElementById('ch2').value

    var vs1=document.getElementById('vs1').value
    var vs2=document.getElementById('vs2').value

    var qto=document.getElementById('qtype').options;
    var qt=qto[qto.selectedIndex].text;


    q=url+'rs='+bk1+'_'+ch1+'_'+vs1+'&re='+bk2+'_'+ch2+'_'+vs2;

    if(qt!="ALL"){
        q+="&qt="+qt;
    }
    console.log(q);
    resp=getText(q,cb_question);
    //console.log(resp);
    //J=JSON.parse(resp);
    //console.log(J)

    //var e=document.getElementById('question')
    //e.value=J;

}
function cb_question(resp){
    console.log(resp);
    J=JSON.parse(resp);
    console.log(J)

    // show jump button
    var e=document.getElementById('buttonGet');
    e.style.display ='none';
    var e=document.getElementById('buttonJump');
    e.style.display ='block';
    var e=document.getElementById('buttonAnswered');
    e.style.display ='none';

    IWD=0;
    QTYPE=J['TYPE']
    QUESTION=J['QUESTION']
    ANSWER=J['ANSWER']+' ('+J['BOOK']+' '+J['CH']+':'+J['VS'];
    if(J['VE']!=''){
        ANSWER+='-'+J['VE'];
    }
    ANSWER+=')';
    
    // show the question type
    var e=document.getElementById('question')
    e.innerHTML='QUESTION ['+QTYPE+']'

    // let the question time sink in for 1sec
    mytimer=setTimeout(showQuestionType,1000);
}
function showQuestionType(){
    clearTimeout(mytimer);
    // show words 500ms at a time...
    mytimer=setInterval(showq,300);
}
function showq(){
    // show question progressively
    var q=QUESTION.split(' ');
    var e=document.getElementById('question')
    
    var txt='QUESTION ['+QTYPE+']'
    for(var ii=0;ii<IWD;ii++){
        txt+=' '+q[ii];
    }
    e.textContent=txt;

    IWD+=1;
    if(IWD>q.length){
        var e=document.getElementById('msg')
        e.innerHTML="<strong><i>Question complete.</i></strong>"

        console.log('question complete')
        clearInterval(mytimer);
        mytimer=setTimeout(showa,5000);
    }
}
function showa(){
    var e=document.getElementById('buttonGet');
    e.style.display ='block';
    var e=document.getElementById('buttonJump');
    e.style.display ='none';
    var e=document.getElementById('buttonAnswered');
    e.style.display ='none';

    var e=document.getElementById('question')
    e.textContent='QUESTION ['+QTYPE+'] '+QUESTION
    var e=document.getElementById('answer')
    e.textContent='ANSWER: '+ANSWER
    var e=document.getElementById('msg')
    e.textContent='';

    clearTimeout(mytimer);
}
function jump(){
    //var e=document.getElementById('buttonGet');
    //e.style.display ='block';
    var e=document.getElementById('buttonJump');
    e.style.display ='none';
    var e=document.getElementById('buttonAnswered');
    e.style.display ='block';
    // clear the jump timer
    clearTimeout(mytimer);

    var e=document.getElementById('msg')
    e.innerHTML='<strong><i>You have 15 seconds to answer.</i></strong>';

    mytimer=setTimeout(showa,15000);
}
function doneAnswering(){
    showa();
    /*
    var e=document.getElementById('buttonGet');
    e.style.display ='block';
    var e=document.getElementById('buttonJump');
    e.style.display ='none';
    var e=document.getElementById('buttonAnswered');
    e.style.display ='none';

    clearTimeout(mytimer);
    */
}
function getSplash(){
    q="api.php?p"
    resp=getText(q,cb_splash);
}
function cb_splash(resp){
    console.log(resp)
    var e=document.getElementById('splashImg');
    e.src=resp;
    e.alt=getCookie('district');
}
/*
var splashScreen = document.querySelector('.splash');
splashScreen.addEventListener('click',()=>{
  splashScreen.style.opacity = 0;
  setTimeout(()=>{
    splashScreen.classList.add('hidden')
  },610)
})

document.getElementById("toastbtn").onclick = function() {
  var toastElList = [].slice.call(document.querySelectorAll('.toast'))
  var toastList = toastElList.map(function(toastEl) {
    return new bootstrap.Toast(toastEl)
  })
  toastList.forEach(toast => toast.show())
}
*/

checkCookie();
getSplash();

var mytimer;
IWD=0;
QTYPE='';
QUESTION='';
ANSWER='';

</script>


<div style="margin-top: 100px">
<img class="img-fluid rounded mx-auto d-block" alt="" id="splashImg" style="width:50%;max-width:300px"> 
</div>

<!-- The Modal -->
<div id="myModal" class="modal">
    <span class="close">&times;</span>
    <img class="modal-content" id="img01">
    <div id="caption"></div>
</div>
  
<script>
  // Get the modal
  var modal = document.getElementById("myModal");
  
  // Get the image and insert it inside the modal - use its "alt" text as a caption
  var img = document.getElementById("splashImg");
  var modalImg = document.getElementById("img01");
  var captionText = document.getElementById("caption");
  img.onclick = function(){
    modal.style.display = "block";
    modalImg.src = this.src;
    captionText.innerHTML = this.alt;
  }
  
  // Get the <span> element that closes the modal
  var span = document.getElementsByClassName("close")[0];
  
  // When the user clicks on <span> (x), close the modal
  span.onclick = function() { 
    modal.style.display = "none";
    img.style.display="none";
    img.classList.remove('d-block')
    
  }
  </script>

</body>
</html>